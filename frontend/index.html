<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªã Tr∆∞·ªùng Ch·ª©ng Kho√°n Vi·ªát Nam | Vietnam Stock Market Overview - quanganh.org</title>

    <!-- Primary SEO Meta Tags -->
    <meta name="description"
        content="To√†n c·∫£nh th·ªã tr∆∞·ªùng ch·ª©ng kho√°n Vi·ªát Nam. Theo d√µi VN-Index, HNX, VN30, UPCOM realtime. Bi·ªÉu ƒë·ªì P/E l·ªãch s·ª≠, tin t·ª©c ch·ª©ng kho√°n, top c·ªï phi·∫øu tƒÉng/gi·∫£m, giao d·ªãch kh·ªëi ngo·∫°i.">
    <meta name="keywords"
        content="vnindex, vn-index, vn30, hnx, upcom, ch·ª©ng kho√°n vi·ªát nam, stock market vietnam, th·ªã tr∆∞·ªùng ch·ª©ng kho√°n, ƒë·ªãnh gi√° c·ªï phi·∫øu, pe ratio vietnam, kh·ªëi ngo·∫°i, top gainers, top losers, tin t·ª©c ch·ª©ng kho√°n">
    <meta name="author" content="Quang Anh">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://valuation.quanganh.org/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://valuation.quanganh.org/">
    <meta property="og:title" content="Th·ªã Tr∆∞·ªùng Ch·ª©ng Kho√°n Vi·ªát Nam | Vietnam Stock Market Overview">
    <meta property="og:description"
        content="To√†n c·∫£nh th·ªã tr∆∞·ªùng ch·ª©ng kho√°n Vi·ªát Nam. VN-Index, HNX, VN30 realtime. P/E chart, tin t·ª©c, top movers.">
    <meta property="og:image" content="https://valuation.quanganh.org/og-image.png">
    <meta property="og:locale" content="vi_VN">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Th·ªã Tr∆∞·ªùng Ch·ª©ng Kho√°n Vi·ªát Nam">
    <meta name="twitter:description" content="To√†n c·∫£nh th·ªã tr∆∞·ªùng ch·ª©ng kho√°n Vi·ªát Nam realtime.">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0d9668">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Th·ªã Tr∆∞·ªùng Ch·ª©ng Kho√°n Vi·ªát Nam",
        "alternateName": ["Vietnam Stock Market", "VN-Index Tracker", "Quang Anh Stock"],
        "url": "https://valuation.quanganh.org",
        "description": "To√†n c·∫£nh th·ªã tr∆∞·ªùng ch·ª©ng kho√°n Vi·ªát Nam realtime. VN-Index, HNX, VN30, UPCOM.",
        "inLanguage": "vi"
    }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/variables.css?v=1">
    <link rel="stylesheet" href="style.css?v=18">
    <link rel="stylesheet" href="css/ticker-autocomplete.css?v=1">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #fafafa;
            color: #1a1a1a;
            line-height: 1.5;
        }

        /* Status dots */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }

        .status-dot.closed {
            background: #ef4444;
        }

        /* ============ MAIN LAYOUT (2 columns) ============ */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                order: -1;
            }
        }

        /* ============ INDEX CARDS GRID (2x2) ============ */
        .indices-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 600px) {
            .indices-grid {
                grid-template-columns: 1fr;
            }
        }

        .index-card {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            padding: 20px;
            transition: box-shadow 0.2s;
        }

        .index-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .index-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .index-name {
            font-size: 14px;
            font-weight: 500;
            color: #666;
        }

        .index-symbol {
            font-size: 12px;
            color: #999;
        }

        .index-change {
            text-align: right;
        }

        .change-percent {
            font-size: 14px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .change-percent.positive {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .change-percent.negative {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .change-value {
            font-size: 12px;
            color: #999;
            margin-top: 2px;
        }

        .index-chart {
            height: 60px;
            margin: 12px 0;
        }

        .index-value {
            font-size: 24px;
            font-weight: 600;
            color: #1a1a1a;
        }

        /* ============ MARKET SUMMARY ============ */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .section-meta {
            font-size: 12px;
            color: #999;
        }

        .news-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .news-item {
            display: flex;
            gap: 16px;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-thumb {
            width: 120px;
            height: 80px;
            flex-shrink: 0;
            border-radius: 8px;
            background: #f0f0f0;
            overflow: hidden;
            order: 2;
            /* Check if this moves it to right */
        }

        .news-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .news-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
            order: 1;
        }

        .news-title {
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
            color: #1a1a1a;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .news-title a {
            text-decoration: none;
            color: inherit;
        }

        .news-title a:hover {
            color: #0d9668;
        }

        .news-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: #999;
            flex-wrap: wrap;
        }

        .stock-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            background: #f3f4f6;
            border-radius: 4px;
            font-weight: 600;
            color: #374151;
            font-size: 11px;
            white-space: nowrap;
        }

        .stock-tag.positive {
            color: #0d9668;
            background: #ecfdf5;
        }

        .stock-tag.negative {
            color: #ef4444;
            background: #fef2f2;
        }

        .news-excerpt {
            font-size: 12px;
            color: #666;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* ============ SIDEBAR ============ */
        .sidebar-section {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .watchlist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
            transition: background 0.2s;
        }

        .watchlist-item:hover {
            background: #fafafa;
            margin: 0 -20px;
            padding-left: 20px;
            padding-right: 20px;
        }

        .watchlist-item:last-child {
            border-bottom: none;
        }

        .stock-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }

        .stock-info {
            flex: 1;
        }

        .movers-tabs {
            display: flex;
            background: #f3f4f6;
            /* Gray-100 */
            padding: 4px;
            border-radius: 8px;
            gap: 4px;
            margin-bottom: 16px;
        }

        .mover-tab,
        .foreign-tab {
            flex: 1;
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: #6b7280;
            /* Gray-500 */
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
            white-space: nowrap;
            text-align: center;
        }

        .mover-tab:hover,
        .foreign-tab:hover {
            color: #111827;
            /* Gray-900 */
        }

        .mover-tab.active,
        .foreign-tab.active {
            background: #ffffff;
            color: #111827;
            /* Gray-900 */
            font-weight: 600;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        /* Optional: Color specific active states if desired, but clean white is more premium */
        /* .mover-tab.active[data-type="gainers"] { color: #10b981; } */
        /* .mover-tab.active[data-type="losers"] { color: #ef4444; } */

        .stock-name {
            font-size: 14px;
            font-weight: 500;
            color: #1a1a1a;
        }

        .stock-symbol-small {
            font-size: 12px;
            color: #999;
        }

        .stock-price-info {
            text-align: right;
        }

        .stock-price {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .stock-change-small {
            font-size: 12px;
        }

        .stock-change-small.positive {
            color: #10b981;
        }

        .stock-change-small.negative {
            color: #ef4444;
        }



        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #999;
            font-size: 14px;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e5e5e5;
            border-top-color: #0d9668;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Time Range Buttons */
        .time-range-buttons {
            display: flex;
            gap: 4px;
        }

        .time-btn {
            padding: 6px 12px;
            border: 1px solid #e5e5e5;
            background: #fff;
            color: #666;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .time-btn:hover {
            background: #f5f5f5;
        }

        .time-btn.active {
            background: #0d9668;
            color: #fff;
            border-color: #0d9668;
        }

        /* ============ RESPONSIVE ============ */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                display: flex;
                flex-direction: column;
            }

            .left-column {
                order: 1;
            }

            .sidebar {
                order: 2;
                margin-top: 24px;
            }
        }

        @media (max-width: 768px) {

            /* Reduce main content padding on mobile - small margin for breathing room */
            .main-content {
                padding: 16px !important;
                padding-top: 60px !important;
                gap: 8px;
                margin: 0 !important;
            }

            .left-column {
                padding: 0 !important;
                margin: 0 !important;
            }

            .header-inner {
                flex-direction: column;
                gap: 12px;
            }

            .search-bar {
                width: 100%;
                max-width: none;
            }

            /* Force 2 columns for indices on mobile */
            .indices-grid {
                grid-template-columns: 1fr 1fr;
                gap: 4px;
                margin: 0 0 8px 0 !important;
                padding: 0 !important;
            }

            .index-card {
                padding: 10px;
                /* Reduce padding to fit */
                min-width: 0;
                /* CRITICAL for grid item shrinking */
                overflow: hidden;
                /* Prevent spillover */
            }

            .index-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 2px;
                /* Tighter gap */
                margin-bottom: 8px;
            }

            .index-name {
                font-size: 14px;
                /* Larger */
                font-weight: 700;
                /* Bold */
                color: #111827;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 100%;
            }

            .index-symbol {
                display: none;
                /* User requested removal */
            }

            .index-change {
                text-align: left;
                width: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 4px;
            }

            .change-percent {
                font-size: 11px;
                padding: 1px 4px;
            }

            .change-value {
                font-size: 10px;
            }

            .index-value {
                font-size: 16px;
                margin-top: 4px;
            }

            /* Responsive Chart */
            .index-chart {
                height: 50px;
                width: 100%;
                position: relative;
            }

            .index-chart canvas {
                width: 100% !important;
                height: 100% !important;
                max-width: 100%;
            }

            .news-item {
                padding: 12px 0;
            }

            .news-title {
                font-size: 14px;
            }

            .news-thumb {
                width: 80px;
                height: 60px;
            }

            .sidebar-section {
                padding: 16px;
                box-shadow: none;
                /* Flatter look on mobile */
                border-radius: 0;
                border-left: none;
                border-right: none;
            }
        }

        /* Remove the old single-column override if it exists separately */
        @media (max-width: 600px) {
            .indices-grid {
                grid-template-columns: 1fr 1fr !important;
            }
        }
    </style>
</head>

<body class="app-container">
    <!-- Header - Same style as valuation.html for seamless navigation -->
    <header class="app-header py-16"
        style="position: fixed; top: 0; left: 0; width: 100%; z-index: 9999; background: var(--color-background, #fff); border-bottom: 1px solid var(--color-border, #e5e5e5);">
        <div class="container header-bar">
            <form class="search-form header-search-form" onsubmit="return false;">
                <div class="search-container-v2 search-container-compact">
                    <!-- Search Icon -->
                    <div class="search-icon-wrapper">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="search-icon-prefix">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </div>
                    <!-- Main Input -->
                    <div class="search-input-wrapper-compact">
                        <input type="text" id="symbol-search" class="search-input-compact"
                            placeholder="T√¨m c·ªï phi·∫øu ƒë·ªÉ xem ƒë·ªãnh gi√° chi ti·∫øt..." autocomplete="off">
                    </div>
                </div>
            </form>
        </div>
    </header>

    <!-- Main Content - with padding for fixed header -->
    <main class="main-content" style="padding-top: 100px;">
        <!-- Left Column -->
        <div class="left-column">
            <!-- Index Cards Grid -->
            <div class="indices-grid">
                <div class="index-card" id="vnindex-card">
                    <div class="index-header">
                        <div>
                            <div class="index-name">VN-Index</div>
                            <div class="index-symbol">VNINDEX</div>
                        </div>
                        <div class="index-change">
                            <div class="change-percent positive" id="vnindex-percent">+0.00%</div>
                            <div class="change-value" id="vnindex-change">+0.00</div>
                        </div>
                    </div>
                    <div class="index-chart">
                        <canvas id="vnindex-chart"></canvas>
                    </div>
                    <div class="index-value" id="vnindex-value">--</div>
                </div>

                <div class="index-card" id="hnxindex-card">
                    <div class="index-header">
                        <div>
                            <div class="index-name">HNX-Index</div>
                            <div class="index-symbol">HNX</div>
                        </div>
                        <div class="index-change">
                            <div class="change-percent positive" id="hnx-percent">+0.00%</div>
                            <div class="change-value" id="hnx-change">+0.00</div>
                        </div>
                    </div>
                    <div class="index-chart">
                        <canvas id="hnx-chart"></canvas>
                    </div>
                    <div class="index-value" id="hnx-value">--</div>
                </div>

                <div class="index-card" id="vn30-card">
                    <div class="index-header">
                        <div>
                            <div class="index-name">VN30</div>
                            <div class="index-symbol">VN30</div>
                        </div>
                        <div class="index-change">
                            <div class="change-percent positive" id="vn30-percent">+0.00%</div>
                            <div class="change-value" id="vn30-change">+0.00</div>
                        </div>
                    </div>
                    <div class="index-chart">
                        <canvas id="vn30-chart"></canvas>
                    </div>
                    <div class="index-value" id="vn30-value">--</div>
                </div>

                <div class="index-card" id="upcom-card">
                    <div class="index-header">
                        <div>
                            <div class="index-name">UPCOM</div>
                            <div class="index-symbol">UPCOM</div>
                        </div>
                        <div class="index-change">
                            <div class="change-percent negative" id="upcom-percent">-0.00%</div>
                            <div class="change-value" id="upcom-change">-0.00</div>
                        </div>
                    </div>
                    <div class="index-chart">
                        <canvas id="upcom-chart"></canvas>
                    </div>
                    <div class="index-value" id="upcom-value">--</div>
                </div>
            </div>

            <!-- P/E Chart Section -->
            <div class="pe-section" style="margin-bottom: 24px;">
                <div class="section-header">
                    <h2 class="section-title">üìä ƒê·ªãnh Gi√°</h2>
                    <div class="time-range-buttons" id="time-range-buttons">
                        <button class="time-btn" data-months="1">1M</button>
                        <button class="time-btn" data-months="3">3M</button>
                        <button class="time-btn" data-months="6">6M</button>
                        <button class="time-btn active" data-months="12">1Y</button>
                        <button class="time-btn" data-months="0">ALL</button>
                    </div>
                </div>
                <div style="display: flex; gap: 24px; margin-bottom: 16px;">
                    <div>
                        <div style="font-size: 12px; color: #999;">P/E Th·ªã tr∆∞·ªùng</div>
                        <div style="font-size: 28px; font-weight: 600; color: #ef4444;" id="pe-value">--</div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #999;">VN-Index</div>
                        <div style="font-size: 28px; font-weight: 600; color: #3b82f6;" id="vnindex-pe">--</div>
                    </div>
                    <div style="margin-left: auto; display: flex; gap: 16px; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <div style="width: 12px; height: 3px; background: #ef4444; border-radius: 2px;"></div>
                            <span style="font-size: 12px; color: #666;">P/E</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <div style="width: 12px; height: 3px; background: #3b82f6; border-radius: 2px;"></div>
                            <span style="font-size: 12px; color: #666;">VN-Index</span>
                        </div>
                    </div>
                </div>
                <div
                    style="height: 250px; background: #fff; border: 1px solid #e5e5e5; border-radius: 12px; padding: 16px;">
                    <canvas id="pe-main-chart"></canvas>
                </div>
            </div>

            <!-- Market Summary -->
            <div class="section-header">
                <h2 class="section-title">üì∞ Market Summary</h2>
                <span class="section-meta" id="news-update-time">C·∫≠p nh·∫≠t v√†i ph√∫t tr∆∞·ªõc</span>
            </div>
            <div class="news-list" id="news-list">
                <div class="loading">
                    <div class="spinner"></div>
                    ƒêang t·∫£i tin t·ª©c...
                </div>
            </div>
        </div>

        <!-- Right Column (Sidebar) -->
        <aside class="sidebar">
            <!-- Top Movers -->
            <div class="sidebar-section">
                <div class="sidebar-title">
                    üî• Top Bi·∫øn ƒê·ªông
                </div>
                <div class="movers-tabs">
                    <button class="mover-tab active" data-type="gainers">üìà TƒÉng</button>
                    <button class="mover-tab" data-type="losers">üìâ Gi·∫£m</button>
                </div>
                <div id="movers-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        ƒêang t·∫£i...
                    </div>
                </div>
            </div>

            <!-- Foreign Flows (Market Breadth/Signal) -->
            <div class="sidebar-section">
                <div class="sidebar-title">
                    üí∞ Kh·ªëi Ngo·∫°i
                </div>
                <div class="movers-tabs">
                    <button class="foreign-tab active" data-type="foreign-buy">NN Mua</button>
                    <button class="foreign-tab" data-type="foreign-sell">NN B√°n</button>
                </div>
                <div id="foreign-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        ƒêang t·∫£i...
                    </div>
                </div>
            </div>

            <!-- Watchlist -->
            <div class="sidebar-section">
                <div class="sidebar-title">
                    ‚≠ê Watchlist
                    <span style="font-size: 12px; color: #999;">Th√™m m√£</span>
                </div>
                <div id="watchlist">
                    <div class="watchlist-item" onclick="location.href='index.html?symbol=VCB'">
                        <div class="stock-icon">VCB</div>
                        <div class="stock-info">
                            <div class="stock-name">Vietcombank</div>
                            <div class="stock-symbol-small">VCB ¬∑ HOSE</div>
                        </div>
                        <div class="stock-price-info">
                            <div class="stock-price">57,100</div>
                            <div class="stock-change-small positive">+0.35%</div>
                        </div>
                    </div>
                    <div class="watchlist-item" onclick="location.href='index.html?symbol=FPT'">
                        <div class="stock-icon">FPT</div>
                        <div class="stock-info">
                            <div class="stock-name">FPT Corporation</div>
                            <div class="stock-symbol-small">FPT ¬∑ HOSE</div>
                        </div>
                        <div class="stock-price-info">
                            <div class="stock-price">92,500</div>
                            <div class="stock-change-small negative">-0.54%</div>
                        </div>
                    </div>
                    <div class="watchlist-item" onclick="location.href='index.html?symbol=VNM'">
                        <div class="stock-icon">VNM</div>
                        <div class="stock-info">
                            <div class="stock-name">Vinamilk</div>
                            <div class="stock-symbol-small">VNM ¬∑ HOSE</div>
                        </div>
                        <div class="stock-price-info">
                            <div class="stock-price">72,300</div>
                            <div class="stock-change-small positive">+1.12%</div>
                        </div>
                    </div>
                    <div class="watchlist-item" onclick="location.href='index.html?symbol=HPG'">
                        <div class="stock-icon">HPG</div>
                        <div class="stock-info">
                            <div class="stock-name">H√≤a Ph√°t</div>
                            <div class="stock-symbol-small">HPG ¬∑ HOSE</div>
                        </div>
                        <div class="stock-price-info">
                            <div class="stock-price">26,900</div>
                            <div class="stock-change-small positive">+2.48%</div>
                        </div>
                    </div>
                </div>
        </aside>
    </main>

    <script>
        // ============ API ENDPOINTS ============
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:5000'
            : 'https://api.quanganh.org';

        const API = {
            PE_CHART: `${API_BASE}/api/market/pe-chart`,
            REALTIME: `${API_BASE}/api/market/realtime`,
            INDICES: `${API_BASE}/api/market/indices`,
            REALTIME_CHART: `${API_BASE}/api/market/realtime-chart`,
            REALTIME_MARKET: `${API_BASE}/api/market/realtime-market`,
            REPORTS: `${API_BASE}/api/market/reports`,
            NEWS: `${API_BASE}/api/market/news?page=1&size=100`,
            TOP_MOVERS: `${API_BASE}/api/market/top-movers`,
            FOREIGN_FLOW: `${API_BASE}/api/market/foreign-flow`
        };

        // Index IDs from CafeF: 1=VNINDEX, 2=HNX, 9=UPCOM, 11=VN30
        const INDEX_MAP = {
            '1': { id: 'vnindex', name: 'VN-Index' },
            '2': { id: 'hnx', name: 'HNX-Index' },
            '9': { id: 'upcom', name: 'UPCOM' },
            '11': { id: 'vn30', name: 'VN30' }
        };

        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', function () {
            updateClock();
            setInterval(updateClock, 1000);

            loadAllIndicesWithCharts();
            loadNews();
            loadTopMovers('gainers');
            setupMoverTabs();
            setupForeignTabs(); // Initialize foreign tabs
            setupTimeRangeButtons();
            loadPEChart();

            // Search functionality
            document.getElementById('stock-search').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    const symbol = this.value.trim().toUpperCase();
                    if (symbol) window.location.href = `index.html?symbol=${symbol}`;
                }
            });
        });

        // ============ CLOCK & STATUS ============
        function updateClock() {
            const now = new Date();
            const dateOptions = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('vi-VN', dateOptions);

            const hour = now.getHours();
            const isOpen = hour >= 9 && hour < 15 && now.getDay() !== 0 && now.getDay() !== 6;
            const statusDot = document.getElementById('market-status-dot');
            const statusText = document.getElementById('market-status-text');

            if (isOpen) {
                statusDot.classList.remove('closed');
                statusText.textContent = 'ƒêang m·ªü';
            } else {
                statusDot.classList.add('closed');
                statusText.textContent = 'ƒê√£ ƒë√≥ng';
            }
        }

        // ============ LOAD ALL INDICES WITH SPARKLINE CHARTS ============
        async function loadAllIndicesWithCharts() {
            try {
                // Fetch market data for all indices
                const marketResponse = await fetch(`${API.REALTIME_MARKET}?indices=1;2;9;11`);
                const marketData = await marketResponse.json();

                // Process each index
                for (const [indexId, info] of Object.entries(INDEX_MAP)) {
                    const data = marketData[indexId];
                    if (!data) continue;

                    const currentIndex = data.CurrentIndex;
                    const prevIndex = data.PrevIndex;
                    const change = currentIndex - prevIndex;
                    const percent = prevIndex > 0 ? (change / prevIndex) * 100 : 0;
                    const isUp = change >= 0;

                    // Update UI
                    document.getElementById(`${info.id}-value`).textContent = currentIndex?.toLocaleString('vi-VN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    document.getElementById(`${info.id}-change`).textContent = (isUp ? '+' : '') + change.toFixed(2);
                    document.getElementById(`${info.id}-percent`).textContent = (isUp ? '+' : '') + percent.toFixed(2) + '%';
                    document.getElementById(`${info.id}-percent`).className = 'change-percent ' + (isUp ? 'positive' : 'negative');

                    // Update P/E sidebar if VN-Index
                    if (indexId === '1') {
                        document.getElementById('vnindex-pe').textContent = currentIndex?.toLocaleString('vi-VN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    }

                    // Load sparkline chart for this index
                    loadIndexChart(indexId, info.id, isUp);
                }
            } catch (error) {
                console.error('Error loading indices:', error);
            }
        }

        async function loadIndexChart(indexId, elementId, isUp) {
            try {
                const response = await fetch(`${API.REALTIME_CHART}?index=${indexId}`);
                const data = await response.json();

                // Data comes as {"1": [...]} format
                const chartData = data[indexId];
                if (chartData && chartData.length > 0) {
                    // Extract "Data" field (index value) from each point
                    const values = chartData.map(point => point.Data).reverse(); // Reverse to show oldest->newest
                    createMiniChart(`${elementId}-chart`, values, isUp);
                }
            } catch (error) {
                console.error(`Error loading chart for index ${indexId}:`, error);
            }
        }

        // ============ MINI SPARKLINE CHART ============
        function createMiniChart(canvasId, data, isUp) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const color = isUp ? '#10b981' : '#ef4444';

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map((_, i) => i),
                    datasets: [{
                        data: data,
                        borderColor: color,
                        borderWidth: 2,
                        fill: true,
                        backgroundColor: isUp ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    interaction: { enabled: false }
                }
            });
        }

        // ============ LOAD MARKET SUMMARY ============
        async function loadNews() {
            const container = document.getElementById('news-list');
            try {
                // Try fetching News first
                const response = await fetch(API.NEWS);
                const result = await response.json();

                // CafeF News API usually wraps content in "Data"
                const data = result.Data || (Array.isArray(result) ? result : []);

                if (data && data.length > 0) {
                    container.innerHTML = data.slice(0, 10).map(item => {
                        // Correct keys from debug_news.json
                        const title = item.Title || '';
                        const link = item.Link || item.NewsUrl || '#';
                        const url = link.startsWith('http') ? link : `https://cafef.vn${link}`;

                        // Image field: Debug shows "ImageThumb"
                        const img = item.ImageThumb || item.Avatar || item.Image || '';

                        // Parse date: Debug shows "PostDate": "/Date(1766901060000)/"
                        const dateStr = item.PostDate || item.PublishDate || item.Date;
                        const timeDisplay = formatDate(dateStr);

                        // Parse stock info: Debug shows "Symbol", "Price", "ChangePrice"
                        const symbol = item.Symbol || '';
                        let stockHtml = '';
                        if (symbol) {
                            const change = item.ChangePrice || 0;
                            const isUp = change >= 0;
                            const changeClass = isUp ? 'positive' : 'negative';
                            // Ensure numeric formatting
                            const priceDisplay = item.Price ? `${item.Price} ` : '';
                            const changeDisplay = change ? `${isUp ? '+' : ''}${change}` : '';

                            stockHtml = `
                                <div class="stock-tag ${changeClass}" onclick="event.stopPropagation(); window.location.href='index.html?symbol=${symbol}'" style="cursor: pointer;">
                                    ${symbol} ${priceDisplay}${changeDisplay}
                                </div>
                            `;
                        }

                        // Image logic: if error, hide parent.
                        const imageHtml = img ? `
                            <div class="news-thumb">
                                <img src="${img}" alt="${title}" loading="lazy" onerror="this.parentElement.style.display='none'">
                            </div>
                        ` : '';

                        return `
                        <div class="news-item">
                            ${imageHtml}
                            <div class="news-content">
                                <div class="news-title">
                                    <a href="${url}" target="_blank">${title}</a>
                                </div>
                                <div class="news-meta">
                                    ${stockHtml}
                                    <span>${timeDisplay}</span>
                                </div>
                            </div>
                        </div>
                    `}).join('');
                } else {
                    // Fallback to Reports if News is empty
                    console.warn('News data empty, using fallback.');
                    await loadReportsAsFallback(container);
                }
            } catch (error) {
                console.error('Error loading news, falling back to reports:', error);
                await loadReportsAsFallback(container);
            }
        }

        async function loadReportsAsFallback(container) {
            try {
                const response = await fetch(`${API.REPORTS}?take=6`);
                const result = await response.json();

                // Handle both array and {Data: [...]} format
                const data = Array.isArray(result) ? result : (result.Data || []);

                if (data.length > 0) {
                    container.innerHTML = data.map(item => `
                        <div class="news-item">
                            <div class="news-title">
                                <a href="${item.url || '#'}" target="_blank">${item.title}</a>
                            </div>
                            <div class="news-excerpt">${item.organName || ''} ¬∑ ${formatDate(item.createdDate)}</div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<div class="loading">Kh√¥ng c√≥ tin t·ª©c</div>';
                }
            } catch (error) {
                console.error('Error loading reports:', error);
                container.innerHTML = '<div class="loading">Kh√¥ng c√≥ tin t·ª©c</div>';
            }
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            try {
                let date;
                if (typeof dateStr === 'string' && dateStr.includes('/Date(')) {
                    const ms = parseInt(dateStr.match(/\d+/)[0]);
                    date = new Date(ms);
                } else {
                    date = new Date(dateStr);
                }

                // Format: HH:mm dd/MM/yyyy
                return date.toLocaleString('vi-VN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            } catch { return ''; }
        }

        // ============ TOP MOVERS ============
        async function loadTopMovers(type) {
            const container = document.getElementById('movers-list');
            container.innerHTML = '<div class="loading"><div class="spinner"></div>ƒêang t·∫£i...</div>';

            try {
                let url;
                if (type === 'gainers') {
                    url = `${API.TOP_MOVERS}?centerID=HOSE&type=UP`;
                } else if (type === 'losers') {
                    url = `${API.TOP_MOVERS}?centerID=HOSE&type=DOWN`;
                } else if (type === 'foreign-buy') {
                    url = `${API.FOREIGN_FLOW}?type=buy`;
                }

                const response = await fetch(url);
                const result = await response.json();
                const data = (result.Data || []).slice(0, 6);

                if (data.length === 0) {
                    container.innerHTML = '<div class="loading">Kh√¥ng c√≥ d·ªØ li·ªáu</div>';
                    return;
                }

                const isForeign = type === 'foreign-buy';
                container.innerHTML = data.map(item => {
                    const percent = item.ChangePricePercent;
                    const isUp = type === 'gainers' || (type === 'foreign-buy');
                    const changeClass = type === 'losers' ? 'negative' : 'positive';
                    const changeText = isForeign
                        ? (Math.abs(item.Value) / 1e9).toFixed(1) + ' t·ª∑'
                        : (percent >= 0 ? '+' : '') + percent.toFixed(2) + '%';

                    return `
                        <div class="watchlist-item" onclick="location.href='index.html?symbol=${item.Symbol}'">
                            <div class="stock-icon">${item.Symbol.slice(0, 3)}</div>
                            <div class="stock-info">
                                <div class="stock-name">${item.Symbol}</div>
                                <div class="stock-symbol-small">${item.CompanyName?.slice(0, 25) || ''}...</div>
                            </div>
                            <div class="stock-price-info">
                                <div class="stock-price">${item.CurrentPrice?.toLocaleString('vi-VN')}</div>
                                <div class="stock-change-small ${changeClass}">${changeText}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading top movers:', error);
                container.innerHTML = '<div class="loading">L·ªói t·∫£i d·ªØ li·ªáu</div>';
            }
        }

        function setupMoverTabs() {
            document.querySelectorAll('.mover-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    document.querySelectorAll('.mover-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    loadTopMovers(this.dataset.type);
                });
            });
        }

        // ============ FOREIGN FLOWS ============
        async function loadForeignFlows(type) {
            const container = document.getElementById('foreign-list');
            if (!container) return;

            container.innerHTML = '<div class="loading"><div class="spinner"></div>ƒêang t·∫£i...</div>';

            try {
                // Determine API typeparam based on selection
                // type: 'foreign-buy' -> type=buy (default endpoint logic)
                const apiType = type === 'foreign-buy' ? 'buy' : 'sell';
                // Backend endpoint is /api/market/foreign-flow?type=...
                // Assuming backend supports type=sell? The frontend API const says FOREIGN_FLOW.
                // Let's assume standard vnstock/CafeF param is 'type'.
                // If backend only returns 'net', we might need to adjust.

                const url = `${API.FOREIGN_FLOW}?type=${apiType}`;

                const response = await fetch(url);
                const result = await response.json();
                const data = (result.Data || []).slice(0, 5); // Top 5

                if (data.length === 0) {
                    container.innerHTML = '<div class="loading">Kh√¥ng c√≥ d·ªØ li·ªáu</div>';
                    return;
                }

                container.innerHTML = data.map(item => {
                    // Item structure from Foreign Flow API usually has Symbol, Value (net value?)
                    // For "buy" or "sell" specific lists, Value is volume or value.
                    // Let's assume standard structure: Symbol, Value (VND)
                    const valueDisplay = (item.Value / 1e9).toFixed(1) + ' t·ª∑';

                    return `
                        <div class="watchlist-item" onclick="location.href='index.html?symbol=${item.Symbol}'">
                            <div class="stock-icon" style="background:${type === 'foreign-buy' ? '#ecfdf5' : '#fef2f2'}; color:${type === 'foreign-buy' ? '#10b981' : '#ef4444'}">${item.Symbol.slice(0, 3)}</div>
                            <div class="stock-info">
                                <div class="stock-name">${item.Symbol}</div>
                                <div class="stock-symbol-small">${item.CompanyName?.slice(0, 20) || ''}...</div>
                            </div>
                            <div class="stock-price-info">
                                <div class="stock-price">${item.CurrentPrice?.toLocaleString('vi-VN')}</div>
                                <div class="stock-change-small ${type === 'foreign-buy' ? 'positive' : 'negative'}">${valueDisplay}</div>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading foreign flows:', error);
                container.innerHTML = '<div class="loading">L·ªói t·∫£i d·ªØ li·ªáu</div>';
            }
        }

        function setupForeignTabs() {
            document.querySelectorAll('.foreign-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    // Only remove active from foreign tabs
                    document.querySelectorAll('.foreign-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    loadForeignFlows(this.dataset.type);
                });
            });
            // Initial load
            loadForeignFlows('foreign-buy');
        }

        // ============ P/E CHART & TIME RANGE ============
        let fullPEData = [];
        let peChart = null;

        async function loadPEChart() {
            try {
                const response = await fetch(API.PE_CHART);
                const result = await response.json();

                if (result.Data && result.Data.DataChart) {
                    // Parse data from CafeF structure
                    fullPEData = result.Data.DataChart.map(p => ({
                        date: new Date(p.TimeStamp * 1000),
                        index: p.Index,
                        pe: p.Pe,
                        vnindex: p.Index // Map Index to vnindex for compatibility
                    })).reverse();

                    // Reversing again if needed? CafeF usually descending. 
                    // Let's assume we want ascending (old -> new) for Chart.js
                    // If result.Data.DataChart comes sorted New -> Old, reversing gives Old -> New.
                    // Let's verify sort order: if date[0] < date[1], it's ascending.
                    if (fullPEData.length > 1 && fullPEData[0].date > fullPEData[1].date) {
                        fullPEData.reverse();
                    }

                    // Update latest values (last item in array)
                    const latest = fullPEData[fullPEData.length - 1];
                    document.getElementById('pe-value').textContent = latest.pe.toFixed(2);
                    document.getElementById('vnindex-pe').textContent = latest.vnindex.toLocaleString('vi-VN', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });

                    // Default to 1 Year (12 months)
                    updatePEChart(12);
                }
            } catch (error) {
                console.error('Error loading P/E chart:', error);
            }
        }

        function setupTimeRangeButtons() {
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updatePEChart(parseInt(this.dataset.months));
                });
            });
        }

        function updatePEChart(months) {
            const ctx = document.getElementById('pe-main-chart').getContext('2d');

            let filteredData = fullPEData;
            if (months > 0) {
                const cutoffDate = new Date();
                cutoffDate.setMonth(cutoffDate.getMonth() - months);
                filteredData = fullPEData.filter(d => d.date >= cutoffDate);
            }

            if (peChart) {
                peChart.destroy();
            }

            const isMobile = window.innerWidth < 768;

            peChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredData.map(d => d.date.toLocaleDateString('vi-VN')),
                    datasets: [
                        {
                            label: 'P/E',
                            data: filteredData.map(d => d.pe),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.05)',
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            tension: 0.1,
                            yAxisID: 'y',
                            fill: true
                        },
                        {
                            label: 'VN-Index',
                            data: filteredData.map(d => d.vnindex),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.05)',
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            tension: 0.1,
                            yAxisID: 'y1',
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1a1a1a',
                            bodyColor: '#666',
                            borderColor: '#e5e5e5',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: true,
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toLocaleString('vi-VN', { maximumFractionDigits: 2 });
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    layout: {
                        padding: {
                            bottom: 10 // Add padding to avoid hitting edge
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: {
                                maxTicksLimit: isMobile ? 4 : 8, // Limit ticks on mobile
                                maxRotation: 0,
                                minRotation: 0,
                                font: {
                                    size: isMobile ? 10 : 12
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: { borderDash: [4, 4], color: '#f0f0f0' },
                            title: { display: false }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: { display: false },
                            title: { display: false }
                        }
                    }
                }
            });
        }

        // ========== TICKER AUTOCOMPLETE FOR NAVIGATION ==========
        class OverviewAutocomplete {
            constructor(inputElement) {
                this.input = inputElement;
                this.tickers = [];
                this.dropdown = null;
                this.selectedIndex = -1;
                this.init();
            }

            async init() {
                this.createDropdown();
                await this.loadTickerData();
                this.setupEventListeners();
            }

            createDropdown() {
                this.dropdown = document.createElement('div');
                this.dropdown.className = 'ticker-dropdown';
                // Use CSS from ticker-autocomplete.css - just hide initially
                this.dropdown.style.display = 'none';
                // Append to search-container-v2 which has max-width: 600px
                const container = this.input.closest('.search-container-v2') || this.input.closest('.header-search-form') || this.input.parentElement;
                if (container) {
                    container.style.position = 'relative';
                    container.appendChild(this.dropdown);
                }
            }

            async loadTickerData() {
                try {
                    const response = await fetch('ticker_data.json');
                    if (response.ok) {
                        const data = await response.json();
                        this.tickers = data.tickers || [];
                        console.log(`üìã Loaded ${this.tickers.length} tickers for overview autocomplete`);
                    }
                } catch (error) {
                    console.error('Failed to load ticker data:', error);
                }
            }

            setupEventListeners() {
                this.input.addEventListener('input', (e) => this.handleInput(e));
                this.input.addEventListener('focus', (e) => this.handleInput(e));
                this.input.addEventListener('keydown', (e) => this.handleKeydown(e));
                this.input.addEventListener('blur', () => setTimeout(() => this.close(), 200));
                document.addEventListener('click', (e) => {
                    if (!this.input.contains(e.target) && !this.dropdown.contains(e.target)) {
                        this.close();
                    }
                });
            }

            handleInput(e) {
                const query = this.input.value.trim();
                if (query.length < 1) {
                    this.close();
                    return;
                }
                const results = this.search(query);
                this.render(results);
            }

            handleKeydown(e) {
                const items = this.dropdown.querySelectorAll('.ticker-item');
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    this.selectedIndex = Math.min(this.selectedIndex + 1, items.length - 1);
                    this.updateSelection(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    this.selectedIndex = Math.max(this.selectedIndex - 1, 0);
                    this.updateSelection(items);
                } else if (e.key === 'Enter') {
                    if (this.selectedIndex >= 0 && items[this.selectedIndex]) {
                        e.preventDefault();
                        this.selectItem(items[this.selectedIndex].dataset.symbol);
                    }
                } else if (e.key === 'Escape') {
                    this.close();
                }
            }

            updateSelection(items) {
                items.forEach((item, index) => {
                    item.classList.toggle('selected', index === this.selectedIndex);
                    if (index === this.selectedIndex) {
                        item.scrollIntoView({ block: 'nearest' });
                    }
                });
            }

            search(query) {
                const q = query.toUpperCase();
                const ql = query.toLowerCase();
                return this.tickers
                    .map(t => {
                        let score = 0;
                        const sym = t.symbol.toUpperCase();
                        const name = (t.name || '').toLowerCase();
                        if (sym === q) score = 1000;
                        else if (sym.startsWith(q)) score = 500;
                        else if (sym.includes(q)) score = 200;
                        else if (name.includes(ql)) score = 100;
                        return { ...t, score };
                    })
                    .filter(t => t.score > 0)
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 8);
            }

            render(results) {
                if (!results.length) {
                    this.close();
                    return;
                }
                const query = this.input.value.trim().toUpperCase();
                this.dropdown.innerHTML = results.map((t, i) => `
                    <div class="ticker-item ${i === this.selectedIndex ? 'selected' : ''}" 
                         data-symbol="${t.symbol}"
                         style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f0f0f0; transition: background 0.15s;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-weight: 600; color: #1a1a1a; font-size: 14px;">${this.highlight(t.symbol, query)}</span>
                            <span style="font-size: 11px; color: #999; background: #f5f5f5; padding: 2px 6px; border-radius: 4px;">${t.exchange || ''}</span>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 13px; color: #666; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${t.name || ''}</div>
                            ${t.sector ? `<div style="font-size: 11px; color: #999;">${t.sector}</div>` : ''}
                        </div>
                    </div>
                `).join('');

                this.dropdown.querySelectorAll('.ticker-item').forEach(item => {
                    item.addEventListener('mouseenter', () => item.style.background = '#f9fafb');
                    item.addEventListener('mouseleave', () => item.style.background = '');
                    item.addEventListener('click', () => this.selectItem(item.dataset.symbol));
                });

                this.dropdown.style.display = 'block';
                this.selectedIndex = -1;
            }

            highlight(text, query) {
                const idx = text.toUpperCase().indexOf(query);
                if (idx === -1) return text;
                return text.slice(0, idx) + '<mark style="background: #d1fae5; padding: 0 2px; border-radius: 2px;">' + text.slice(idx, idx + query.length) + '</mark>' + text.slice(idx + query.length);
            }

            selectItem(symbol) {
                this.close();
                // Navigate to valuation page with the selected symbol
                window.location.href = `valuation.html?symbol=${symbol}`;
            }

            close() {
                this.dropdown.style.display = 'none';
                this.selectedIndex = -1;
            }
        }

        // Initialize autocomplete for overview page
        const symbolSearchInput = document.getElementById('symbol-search');
        if (symbolSearchInput) {
            new OverviewAutocomplete(symbolSearchInput);
        }
    </script>
</body>

</html>